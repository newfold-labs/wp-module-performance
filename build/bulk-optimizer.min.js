document.addEventListener("DOMContentLoaded",(()=>{const e="nfd-bulk-optimize-btn";let t=!1;const n=["button","media-button","select-mode-toggle-button"],o=["button","media-button","button-primary","button-large","delete-selected-button"],r=()=>{t=!1;const{progressBar:e,modalTitle:n,currentFileName:o}=(()=>{const e=document.createElement("div");e.id="nfd-bulk-modal",e.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.5);\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            z-index: 9999;\n        ";const n=document.createElement("div");n.style.cssText="\n            background: white;\n            padding: 2rem;\n            border-radius: 8px;\n            text-align: center;\n            width: 400px;\n            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);\n        ";const o=document.createElement("h2");o.id="nfd-modal-title",o.textContent="Optimizing Images...";const r=document.createElement("p");r.id="nfd-current-file",r.textContent="Preparing files...";const d=document.createElement("div");d.style.cssText="\n            width: 100%;\n            height: 20px;\n            background: #eee;\n            border-radius: 10px;\n            margin: 1rem 0;\n            overflow: hidden;\n            position: relative;\n        ";const a=document.createElement("div");a.id="nfd-progress-bar",a.style.cssText="\n            height: 100%;\n            width: 0;\n            background: #007cba;\n            transition: width 0.3s ease;\n        ";const c=document.createElement("button");return c.textContent="Cancel",c.className="button button-secondary",c.style.marginTop="1rem",c.addEventListener("click",(()=>{t=!0,i(),window.location.reload()})),d.appendChild(a),n.append(o,r,d,c),e.appendChild(n),document.body.appendChild(e),{modal:e,progressBar:a,modalTitle:o,currentFileName:r}})();return e.style.width="0%",o.textContent="",{progressBar:e,modalTitle:n,currentFileName:o}},i=()=>{const e=document.getElementById("nfd-bulk-modal");e&&e.remove(),window.location.reload()},d=e=>{const t=e.closest(".media-frame-content"),n=t?.querySelector(".filename");return n?.textContent||"Unknown File"},a=async()=>{const e=Array.from(document.querySelectorAll(".attachment.selected")).map((e=>({id:e.getAttribute("data-id"),name:d(e)})));if(!e.length)return;const n=window.nfdPerformance?.imageOptimization?.bulkOptimizer?.apiUrl;if(!n)return;const{progressBar:o,modalTitle:a,currentFileName:c}=r();try{for(let r=0;r<e.length;r++){if(t){a.textContent="Optimization Canceled";break}const{id:i,name:d}=e[r];c.textContent=`Optimizing: ${d}`;try{await wp.apiFetch({url:n,method:"POST",data:{media_id:parseInt(i,10)}});const t=(r+1)/e.length*100;o.style.width=`${t}%`}catch(e){}}t||(a.textContent="Optimization Complete!",setTimeout(i,2e3))}catch(e){a.textContent="An error occurred.",setTimeout(i,3e3)}},c=()=>{if(document.getElementById(e))return;const t=document.querySelector(".button.media-button.button-primary.button-large.delete-selected-button");if(!s(t,o))return;const n=(()=>{const t=document.createElement("button");return t.id=e,t.className="button media-button button-large button-primary",t.textContent="Optimize",t.disabled=!0,t.addEventListener("click",a),t})();t.parentElement.insertBefore(n,t.nextSibling),l(n)},l=e=>{const t=()=>{const t=document.querySelectorAll(".attachment.selected").length>0;e.disabled=!t},n=document.querySelector(".media-frame-content");n&&(new MutationObserver(t).observe(n,{childList:!0,subtree:!0}),t())},s=(e,t)=>e?.classList.length===t.length&&t.every((t=>e.classList.contains(t)));new MutationObserver((()=>{const t=document.querySelector(".button.media-button.select-mode-toggle-button");s(t,n)?(()=>{const t=document.getElementById(e);t&&t.remove()})():c()})).observe(document.body,{childList:!0,subtree:!0})}));